# 项目大&人员多&构设计更


### 1.大项目、多人、多团队架构思考

#### 1.1 首先

> 项目规模变大后，模块划分必须遵循一定的原则。如果模块划分规则不规范、不清晰，就会导致代码耦合严重的问题，并加大架构重构的难度。这些问题主要表现在：

* 业务需求不断，业务开发不能停。重新划分模块的工作量越大，成本越高，重构技改需求排上日程的难度也就越大。
* 老业务代码年久失修，没有注释，修改起来需要重新梳理逻辑和关系，耗时长。

#### 1.2 其次

> 我们需要搞清楚模块的粒度采用什么标准进行划分，也就是要遵循的原则是什么。对于 iOS 这种面向对象编程的开发模式来说，我们应该遵循以下五个原则

* 单一功能原则：对象功能要单一，不要在一个对象里添加很多功能
* 开闭原则：扩展是开放的，修改是封闭的
* 里氏替换原则：子类对象是可以替代基类对象的
* 接口隔离原则：接口的用途要单一，不要在一个接口上根据不同入参实现多个功能
* 依赖反转原则：方法应该依赖抽象，不要依赖实例。iOS 开发就是高层业务方法依赖于协议

#### 1.3 最后

> 选择合适的粒度。切记，大型项目的模块粒度过大或者过小都不合适

* 组件可以认为是可组装的、独立的业务单元，具有高内聚，低耦合的特性，是一种比较适中的粒度。就像用乐高拼房子一样，每个对象就是一块小积木。一个组件就是由一块一块的小积木组成的有单一功能的组合，比如门、柱子、烟囱。
* iOS 开发中的组件，不是 UI 的控件，也不是 ViewController 这种大 UI 和功能的集合。因为，UI 控件的粒度太小，而页面的粒度又太大。iOS 组件，应该是包含 UI 控件、相关多个小功能的合集，是一种粒度适中的模块


### 2.梳理组件之间的逻辑关系进行改造

#### 2.1 分层

* 底层可以是与业务无关的基础组件，比如网络和存储等
* 中间层一般是通用的业务组件，比如账号、埋点、支付、购物车等
* 最上层是迭代业务组件，更新频率最高


### 3.团队分工&结构


* 首先，需要一个专门的基建团队，负责业务无关的基础功能组件和业务相关通用业务组件的开发
* 然后，每个业务都由一个专门的团队来负责开发。业务可以按照功能耦合度来划分，耦合度高的业务可以划分成单独的业务团队
* 基建团队人员应该是流动的，从业务团队里来，再回到业务团队中去。这么设计是因为业务团队和基建团队的边界不应该非常明显，否则就会出现基建团队埋头苦干，结果可能是做得过多、做得不够，或着功能不好用的问题，造成严重的资源浪费


### 4.解耦

> 解耦的精髓在于业务逻辑能够独立出来，并不是形式上的解除编译上的耦合（编译上解除耦合只能算是解耦的一种手段而已）。所以，在考虑架构设计时，我们更多的还是需要在功能逻辑和组件划分上做到同层级解耦，上下层依赖清晰，这样的结构才能够使得上层组件易插拔，下层组件更稳固。而中间者架构模式更容易维护这种结构，中间者的易管控和易扩展性，也使得整体架构能够长期保持稳健与活力。所以，中间者架构就是我心目中好的架构

