# 性能监控

### 1. 线下

#### 1.1 Instruments

* 关于线下性能监控，苹果公司官方就有一个性能监控工具 Instruments。它是一款被集成在 Xcode 里，专门用来在线下进行性能分析的工具

#### 1.2 功能

* Instruments 的功能非常强大，比如说 Energy Log 就是用来监控耗电量的，Leaks 就是专门用来监控内存泄露问题的，Network 就是用来专门检查网络情况的，Time Profiler 就是通过时间采样来分析页面卡顿问题的

![087ddcf91e5c222804f753389edf2de9](https://user-images.githubusercontent.com/17693976/211303095-1ab88055-406b-475a-bc4c-13608d9ccce9.png)

#### 1.3 优势（Instruments 10 以后）

* Instruments 基于 os_signpost 架构，可以支持所有平台
* Instruments 由于标准界面（Standard UI）和分析核心（Analysis Core）技术，使得我们可以非常方便地进行自定义性能监测工具的开发。给 Instruments 内置的工具换个交互界面或新创建一个工具的时，都可以通过自定义工具这个功能来实现

#### 1.4 开发一款自定义 Instruments 工具，主要步骤：

* 在 Xcode 中，点击 File > New > Project
* 在弹出的 Project 模板选择界面，将其设置为 macOS
* 选择 Instruments Package，点击后即可开始自定义工具的开发了
* 经过上面的三步之后，会在新创建的工程里面生成一个.instrpkg 文件，接下来的开发过程主要就是对这个文件的配置工作了。主要是完成 Standard UI 和 Analysis Core 的配置
* 苹果公司还提供了大量的代码片段，帮助你进行 [个性化配置](https://help.apple.com/instruments/developer/mac/current/)

![e51d838fda0c79ff0a48566ec87305be](https://user-images.githubusercontent.com/17693976/211303851-61742fcb-957d-4e1c-9648-3fb571531bbd.png)

#### 1.5 Analysis Core 收集和处理数据的过程

* 1. 处理我们配置好的各种数据表，并申请存储空间 store
* 2. store 去找数据提供者，如果不能直接找到，就会通过 Modeler 接收其他 store 的输入信号进行合成
* 3. store 获得数据源后，会进行 Binding Solution 工作来优化数据处理过程
